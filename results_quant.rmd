---
title: "Results Quantification"
author: "Shira Salingre"
output: html_document
---

Quantifying networks for 

_Run `results_prelim.Rmd` to get all data sets and subsets_
```{r Source data from the results file, include=FALSE}
# source_rmd <- function(rmd_file){
#   knitr::knit(rmd_file, output = tempfile())
# }
# 
# source_rmd("results_prelim.Rmd")

# file.edit("results_prelim.rmd")
source('scripts/quant_func.R')

```

# Relative importance of species only
**How much of the model is explained by the occurrence of other species?**

## Groupers

```{r}
groupers_temp_relimp <- sapply(X = model_temp_grps$mod$key_coefs, rel_imp, cov = "tmean_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "temp_model" = value)

groupers_mpa_relimp <- sapply(X = model_mpa_grps$mod$key_coefs, rel_imp, cov = "mpa") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "mpa_model" = value)

groupers_depth_relimp <- sapply(X = model_depth_grps$mod$key_coefs, rel_imp, cov = "depth_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "depth_model" = value)

(groupers_spp_relimp <- groupers_temp_relimp %>%
  left_join(groupers_mpa_relimp, by = "species") %>% 
  left_join(groupers_depth_relimp, by = "species"))

```

## Diplodus

```{r}
dip_temp <- sapply(X = model_temp_dip$mod$key_coefs, rel_imp, cov = "tmean_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "temp_model" = value)

dip_mpa <- sapply(X = model_mpa_dip$mod$key_coefs, rel_imp, cov = "mpa") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "mpa_model" = value)

dip_depth <- sapply(X = model_depth_dip$mod$key_coefs, rel_imp, cov = "depth_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "depth_model" = value)

(dip_spp_relimp <- dip_temp %>%
  left_join(dip_mpa, by = "species") %>% 
  left_join(dip_depth, by = "species"))

```

## Herbivores

Relative importance of species only


```{r}
herb_temp <- sapply(X = model_temp_herb$mod$key_coefs, rel_imp, cov = "tmean_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "temp_model" = value)

herb_mpa <- sapply(X = model_mpa_herb$mod$key_coefs, rel_imp, cov = "mpa") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "mpa_model" = value)

herb_depth <- sapply(X = model_depth_herb$mod$key_coefs, rel_imp, cov = "depth_reg") %>% 
  tibble::enframe() %>% 
  rename("species" = name, "depth_model" = value)

(herb_spp_relimp <- herb_temp %>%
  left_join(herb_mpa, by = "species") %>% 
  left_join(herb_depth, by = "species"))

```

# Sum of mean association coefficients for each species
**What is the mean direction of the association of species _i_ with other species and a covariate** (everything that is included in the model)
```{r}
grps_temp_meancoefs <- sapply(X = model_temp_grps$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_temp" = value)

grps_mpa_meancoefs <- sapply(X = model_mpa_grps$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_mpa" = value)

grps_depth_meancoefs <- sapply(X = model_depth_grps$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_depth" = value)

(groupers_spp_meancoef <- grps_temp_meancoefs %>%
  left_join(grps_mpa_meancoefs, by = "species") %>% 
  left_join(grps_depth_meancoefs, by = "species"))

```

## Diplodus

```{r}
dip_temp_meancoefs <- sapply(X = model_temp_dip$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_temp" = value)

dip_mpa_meancoefs <- sapply(X = model_mpa_dip$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_mpa" = value)

dip_depth_meancoefs <- sapply(X = model_depth_dip$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_depth" = value)

(dip_spp_meancoef <- dip_temp_meancoefs %>%
  left_join(dip_mpa_meancoefs, by = "species") %>% 
  left_join(dip_depth_meancoefs, by = "species"))

```


## Herbivores

```{r}
herb_temp_meancoefs <- sapply(X = model_temp_herb$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_temp" = value)

herb_mpa_meancoefs <- sapply(X = model_mpa_herb$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_mpa" = value)

herb_depth_meancoefs <- sapply(X = model_depth_herb$boot$mean_key_coefs, FUN = mean_coef) %>%
  tibble::enframe() %>% 
  rename("species" = name, "sum_mean_coefs_depth" = value)

(herb_spp_meancoef <- herb_temp_meancoefs %>%
  left_join(herb_mpa_meancoefs, by = "species") %>% 
  left_join(herb_depth_meancoefs, by = "species"))

```

_Siganus rivulatus_ coefficients seem to be inflated in all variables

# Networks comparison

Connectance as a measure of comparison.
Connectance by Delams _et al._:

    C0 = [total # of edges] / [total # of nodes^2 (total possible connections)]

L = count(edges) for each network
S = count(nodes) for each network
M = S^2
connectance (C0) = L/M

## Temperature models

### Groupers

```{r}
grps_temp_low_connect <- connectance(x = grps_temp_nested_mod$model[[1]]$graph)
grps_temp_med_connect <- connectance(x = grps_temp_nested_mod$model[[2]]$graph)
grps_temp_hi_connect <- connectance(x = grps_temp_nested_mod$model[[3]]$graph)

```

### Diplodus

```{r}
dip_temp_low_connect <- connectance(x = dip_temp_nested_mod$model[[1]]$graph)
dip_temp_med_connect <- connectance(x = dip_temp_nested_mod$model[[2]]$graph)
dip_temp_hi_connect <- connectance(x = dip_temp_nested_mod$model[[3]]$graph)

```

### Herbivores

```{r}
herb_temp_low_connect <- connectance(x = herb_temp_nested_mod$model[[1]]$graph)
herb_temp_med_connect <- connectance(x = herb_temp_nested_mod$model[[2]]$graph)
herb_temp_hi_connect <- connectance(x = herb_temp_nested_mod$model[[3]]$graph)

```

## MPA models

### Groupers

```{r}
grps_mpa_out_connect <- connectance(x = grps_mpa_nested_mod$model[[1]]$graph)
grps_mpa_in_connect <- connectance(x = grps_mpa_nested_mod$model[[2]]$graph)

```

### Diplodus

```{r}
dip_mpa_out_connect <- connectance(x = dip_mpa_nested_mod$model[[1]]$graph)
dip_mpa_in_connect <- connectance(x = dip_mpa_nested_mod$model[[2]]$graph)

```

### Herbivores

```{r}
herb_mpa_out_connect <- connectance(x = herb_mpa_nested_mod$model[[1]]$graph)
herb_mpa_in_connect <- connectance(x = herb_mpa_nested_mod$model[[2]]$graph)

```

