---
title: "Research Notebook"
output: html_notebook
---
20/02/19

# Data validation #

* data.origin: replaced 9114 incidents of “Sala - PEW” to “sala_pew”
* There are some latitudes that equal integers (1,2,3…)
* sort out caps and spaces: site names; spp names (also parentheses);  season; 
* species names need to be all changed to genus.spp now some with caps and some with spaces
* spp length in cm I guess?
* protection: 35460 replacements for YES in 1; 16278 replacements for NO in 0; 637 replacements of #N/A in NA.

15/07/19
```{r}
library(tidyverse)

functional <- read.csv("C:/Users/Shira/Documents/FishMed - Albouy et al 2015 Ecological Archives E096-203/Functional_data/Functional_data.csv", header = TRUE, sep = ";")
head(functional)
traits <- colnames(functional[7:ncol(functional)])
traits
# These data ^ are of Albouy et al. 2015
str(functional)
summary(functional)

raw_med <- read.csv("C:/Users/Shira/Documents/R/medata/med_raw.csv", na.strings = c("", "NA"))
summary(raw_med)

# create a sites list from all unique sites:
sites <- raw_med %>%
  distinct(site)

# same for locations (this one includes lon and lat)
locations <- raw_med %>%
  distinct(lon, lat, site)

# and one more for species
species <- raw_med %>% 
  distinct(species)

# create myself a useful matrix
med_mat <- raw_med %>% 
  group_by(species) %>% 
  mutate(grouped_id = row_number()) %>% # group_by() and mutate() are a workaround an error
  spread(species, sp.n) %>% 
  select(-sp.length, -a, -b, -grouped_id) # irrelevant variables
med_mat[, 18:136][is.na(med_mat[, 18:136])] <- 0 # change NAs to 0s only for species

head(med_mat)
# last column of metadata is 18
# species are in cols (19:ncol(.))

# check it out:
summary(med_mat)

```

* More info on `med_raw.csv` can be found in repo `/medata/data_warngling_and_acquaintance.html`)

21/07/19
Trying to get countries by coordinates but all the functions/packages don't work well for the sea.. so I'll try and do it from a shapefile of EEZs. It might be worth making a sort of package for it to extract the relevant shapefile and then extract the countries from this shapefile.
Downloaded Marine Regions shp file

* IHO sea areas: Flanders Marine Institute (2018). IHO Sea Areas, version 3. Available online at http://www.marineregions.org/ https://doi.org/10.14284/323
* Marine boundries (EEZ): Flanders Marine Institute (2018). Maritime Boundaries Geodatabase: Maritime Boundaries and Exclusive Economic Zones (200NM), version 10. Available online at http://www.marineregions.org/ https://doi.org/10.14284/312

```{r}
library(sp)
library(rgdal)
library(raster)
# library(maptools)
library(rgeos)
library(tidyverse)

## Load a shapefile that contains the extent of the mediterranean (medmask) and extrat its extent to crop the world shapefile onto it:

poly_mask <- readOGR("C:/Users/Shira/Documents/GIS/Bio-Oracle-Rasters/Mediterranean Mask - not BioOracle/medmask.shp") #load the shapefile
med_extent <- extent(poly_mask) # extract its extent

# Read the shapefile of all EEZs (countries) - from Marine Regions website:
world_eez <- readOGR(dsn = "C:/Users/Shira/Documents/MEData/Marine Regions/World_EEZ_v10_20180221", "eez_v10")

# Create the clipping polygon
CP <- as(med_extent, "SpatialPolygons") # convert extent to SpatialPolygons object
proj4string(CP) <- CRS(proj4string(world_eez)) # set its projection to the same as EEZ file

# Clip the map
med_eez <- gIntersection(world_eez, CP, byid=TRUE)

# Plot the output to check it:
# plot(med_eez, col="khaki", bg="azure2")

head(world_eez@data)


```

